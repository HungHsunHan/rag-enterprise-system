# HR 內部問答系統產品需求文件 (PRD)

## 目標與背景 (Goals and Background Context)

### 目標 (Goals)

* **降低人力資源部門的工作量：** 透過 Chatbot 自動回覆員工關於公司規章制度的常見問題。
* **個人化資訊存取：** 確保不同公司的員工（透過特定編號識別）只能看到與其公司相關的特定資料，實現資料隔離與權限控管。
* **高準確度回覆：** 確保 Chatbot 提供的答案準確度達到 98%，建立員工對系統的信任感。

### 背景 (Background Context)

目前，公司內部員工若有關於規章制度的疑問，主要依賴人力資源部門 (HR) 進行解答。隨著公司規模擴大及制度頻繁更新，HR 的工作量日益增加，且重複性問題佔用了大量時間。

為了解決此痛點，我們計畫開發一個基于 RAG 技術的內部問答系統。此系統不僅能為員工提供即時、準確的答案，還能根據員工所屬的公司提供客製化的內容。同時，系統將提供一個強大的管理後台，讓非技術背景的管理員也能輕鬆、高效地更新知識庫文件、監控系統狀態及分析使用者反饋，從而形成一個持續優化的良性循環。

### 變更日誌 (Change Log)

| 日期 | 版本 | 描述 | 作者 |
| :--- | :--- | :--- | :--- |
| 2025-08-19 | 1.0 | 初始文件建立 | John (PM) |

## 需求 (Requirements)

### 功能需求 (Functional Requirements)

**使用者 (員工) 功能**
* **FR1 (使用者認證與權限):** 員工需透過特定編號登入系統。系統必須能根據其編號，識別其所屬公司，並嚴格隔離知識庫的存取權限。
* **FR2 (問答互動介面):** 提供一個直觀、易於使用的對話介面（Chatbot），讓員工可以輸入關於公司規章制度的問題。
* **FR3 (RAG 答案生成):** 系統接收問題後，應從該員工所屬公司的專屬知識庫中，檢索最相關的資訊，並生成準確、自然的回答。
* **FR4 (使用者反饋機制):** 在每則答案下方，提供簡單的反饋機制（例如：👍/👎），讓員工可以評價答案的實用性。

**管理員功能**
* **FR5 (管理員安全登入):** 管理員擁有獨立的登入系統，與一般員工區分。
* **FR6 (知識文件管理):**
    * **FR6.1 (上傳):** 管理員可以上傳多種格式的文件（如 .pdf, .docx, .txt）至對應公司的知識庫。
    * **FR6.2 (處理):** 系統在上傳後，必須自動對文件進行切割、向量化 (embedding)，並存入對應的向量資料庫。
    * **FR6.3 (檢視):** 管理員可以查看目前知識庫中所有文件的列表。
    * **FR6.4 (刪除):** 管理員可以從列表中刪除文件，系統必須同步將該文件相關的向量資料從資料庫中移除。
* **FR7 (Embedding 資料庫檢視):** 提供一個介面，讓管理員能查看已處理的資料片段 (chunks) 及其對應的文本內容，以利於理解系統的知識構成。
* **FR8 (使用者反饋儀表板):** 管理員可以查看所有員工的問題、系統的回答以及員工的反饋（👍/👎），並可依據反饋類型（如：只看負面反饋）進行篩選。

### 非功能需求 (Non-Functional Requirements)

* **NFR1 (準確性 Accuracy):** 根據您的成功指標，系統回覆問題的內容準確度必須達到 98%。
* **NFR2 (性能 Performance):** 對於一般員工的提問，系統應在 3 秒內生成並顯示答案，以確保流暢的互動體驗。
* **NFR3 (安全性 Security):** 系統必須確保完全的資料隔離。任何情況下，A 公司的員工都不能存取到 B 公司的資料。所有資料在傳輸和儲存時都應加密。
* **NFR4 (易用性 Usability):**
    * **員工介面：** 應極簡且直觀，類似於常見的通訊軟體。
    * **管理介面：** 應為非技術背景的 HR 人員設計，上傳、刪除文件等核心操作應一目了然，無需專門的技術訓練。
* **NFR5 (可維護性 Maintainability):** 知識庫的更新流程必須高效。管理員上傳新文件或刪除舊文件後，系統應在 5 分鐘內完成 embedding 的更新並在前台生效。
* **NFR6 (可擴展性 Scalability):** 系統架構應能水平擴展，以支援未來更多公司（租戶）的加入，以及知識庫文件量的持續增長，而不會顯著降低性能。

## 使用者介面設計目標 (User Interface Design Goals)

### 整體 UX 願景 (Overall UX Vision)
* **對員工而言：** 打造一個極簡、直觀、值得信賴的對話體驗。介面應聚焦於問答本身，避免不必要的干擾，讓員工能快速、輕鬆地獲得所需資訊。
* **對管理員而言：** 提供一個清晰、高效、功能強大的管理儀表板。目標是讓非技術背景的 HR 人員也能自信地完成文件管理和系統監控等任務。

### 核心互動模式 (Key Interaction Paradigms)
* **員工端：** 標準的「一問一答」聊天機器人介面，支援文字輸入和滾動查閱歷史紀錄。
* **管理員端：** 以資料為中心的儀表板設計，包含列表、表格、上傳按鈕、篩選器和清晰的導航菜單。

### 核心畫面與視圖 (Core Screens and Views)
* **員工畫面：**
    1.  員工編號登入頁
    2.  對話主介面
* **管理員畫面：**
    1.  管理員登入頁
    2.  主儀表板 (Dashboard)
    3.  知識庫管理頁 (文件列表、上傳、刪除功能)
    4.  使用者反饋檢視頁 (可篩選的問答與反饋列表)
    5.  Embedding 資料庫檢視頁

### 無障礙設計 (Accessibility)
* 根據您的決策，此專案**不**強制要求遵循特定的無障礙設計標準。

### 品牌 (Branding)
* 採用簡潔、中性且功能導向的設計風格，**無需**遵循特定的品牌指南。

### 目標平台 (Target Platforms)
* 此應用程式將專注於為「**桌面瀏覽器**」提供最佳體驗，**不**進行額外的響應式設計以適配行動裝置。

## 技術假設 (Technical Assumptions)

### 建議技術棧 (Proposed Tech Stack)

* **後端 (Backend) - 語言與框架:**
    * **建議:** **Python** (搭配 FastAPI 或 Flask 框架)
    * **理由:** Python 是目前 AI 與自然語言處理 (NLP) 領域的首選語言，擁有最豐富的函式庫支援（例如 LangChain, LlamaIndex）來打造 RAG 系統，能大幅加速開發。

* **前端 (Frontend) - 語言與框架:**
    * **建議:** **TypeScript** + **React**
    * **理由:** TypeScript 提供型別安全，能減少錯誤。React 是目前最成熟的前端框架之一，擁有龐大的社群和豐富的 UI 元件庫，能快速打造管理儀表板和對話介面。

* **資料庫 (Database):**
    * **已更新:** **PostgreSQL** + **PGVector** 擴充套件
    * **理由:** 這個組合非常高效。PostgreSQL 負責儲存使用者、公司資訊等結構化資料，而 PGVector 擴充套件讓 PostgreSQL 本身就能處理 embedding 向量的儲存與相似度搜尋。這簡化了技術棧，將所有資料統一在一個資料庫系統中管理，降低了 MVP 的維運複雜度。

* **雲端與部署 (Cloud & Deployment):**
    * **已更新:** **暫緩決定 (Decision Deferred)**
    * **理由:** 根據您的指示，MVP 階段我們將專注於本地開發與功能實現，暫不定義雲端部署的具體方案。

### 架構決策 (Architectural Decisions)

* **倉儲結構 (Repository Structure):** **Monorepo (單體式倉儲)**
* **服務架構 (Service Architecture):** **Monolith (單體式服務)**
* **測試需求 (Testing Requirements):** **單元測試 + 整合測試 (Unit + Integration)**

## 史詩列表 (Epic List)

* **Epic 1: 基礎架構與多租戶核心 (Foundation & Multi-Tenant Core)**
    * **目標:** 建立專案骨幹、資料庫模型，並實現能區分不同公司的管理員登入與租戶管理功能。
* **Epic 2: 端到端問答流程建置 (End-to-End Q&A Pipeline)**
    * **目標:** 實現核心的 RAG 問答功能，包括管理員上傳文件自動處理，以及員工透過聊天介面查詢並獲得答案的完整流程。
* **Epic 3: 管理與優化儀表板 (Management & Optimization Dashboard)**
    * **目標:** 擴充管理員後台，加入 Embedding 資料庫檢視功能，並建立使用者反饋儀表板，為系統的持續優化提供數據支持。

## Epic 1: 基礎架構與多租戶核心 (Foundation & Multi-Tenant Core)

**Epic 目標:**
這個 Epic 的核心目標是為整個專案打下堅實的基礎。我們將建立起專案的初始結構、設定好資料庫並定義核心資料模型（公司、員工、管理員）。最終，我們將交付一個最基本但可運作的管理功能：讓管理員能夠登入並新增「公司」，以此驗證多租戶（Multi-Tenant）架構的核心概念是可行的。

#### Story 1.1: 專案初始化與環境設定
* **As a** 開發者 (Developer),
* **I want** 一個設定好前端與後端開發環境的 Monorepo 專案,
* **so that** 我可以順利地開始進行功能開發。
* **驗收標準 (Acceptance Criteria):**
    1.  一個新的 Monorepo 倉儲被成功建立。
    2.  倉儲內包含獨立的 `frontend` (React/TS) 和 `backend` (Python/FastAPI) 應用程式目錄。
    3.  前後端的核心依賴套件（dependencies）都已安裝。
    4.  可以成功執行指令，同時啟動前後端的開發伺服器。

#### Story 1.2: 資料庫初始化與核心模型建立
* **As a** 開發者 (Developer),
* **I want** 建立好 PostgreSQL 資料庫連線並定義出公司、員工和管理員的資料表,
* **so that** 系統有地方可以儲存核心資料。
* **驗收標準 (Acceptance Criteria):**
    1.  後端應用程式可以成功連線到 PostgreSQL 資料庫。
    2.  已建立 `companies`, `users` (員工), 和 `admins` 的資料表 (tables)。
    3.  每個資料表都包含必要的核心欄位（例如：`company_name`, `user_id`, `admin_email` 等）。
    4.  資料表之間的關聯（如：員工屬於某個公司）已正確設定。

#### Story 1.3: 基礎管理員驗證機制
* **As an** 管理員 (Administrator),
* **I want** 一個安全的登入機制,
* **so that** 只有被授權的人員可以存取管理後台。
* **驗收標準 (Acceptance Criteria):**
    1.  後端提供一個 `/api/admin/login` 的登入 API 端點。
    2.  使用正確的管理員帳號密碼呼叫該 API 時，會回傳一個用於驗證的 Token (例如 JWT)。
    3.  使用錯誤的帳號密碼時，會回傳驗證失敗的錯誤訊息。
    4.  後端有一個機制可以保護需要管理員權限才能存取的 API。

#### Story 1.4: 管理員新增公司功能
* **As an** 管理員 (Administrator),
* **I want** 一個可以新增公司的基本介面,
* **so that** 我可以為系統建立不同的租戶（公司）。
* **驗收標準 (Acceptance Criteria):**
    1.  前端有一個 `/admin/companies` 的頁面，且此頁面需要管理員登入後才能瀏覽。
    2.  頁面上顯示目前所有公司的列表。
    3.  頁面上有一個表單，可以輸入新公司的名稱並提交。
    4.  提交後，會呼叫後端 API 將新公司資料寫入資料庫。
    5.  新增成功後，頁面上的公司列表會自動更新。

## Epic 2: 端到端問答流程建置 (End-to-End Q&A Pipeline)

**Epic 目標:**
這個 Epic 的目標是交付產品的核心功能。完成後，管理員將能夠上傳知識文件並讓系統自動學習；同時，員工可以登入系統，針對其公司的專屬知識庫提出問題並獲得由 AI 生成的答案。這將是第一個能完整展示產品價值的可交付版本。

#### Story 2.1: 後端文件上傳與處理管線 (Pipeline)
* **As a** 開發者 (Developer),
* **I want** 一個能接收文件上傳、進行 embedding 處理並存入 PGVector 的後端 API,
* **so that** 系統可以學習新的知識。
* **驗收標準 (Acceptance Criteria):**
    1.  提供一個受管理員權限保護的 API 端點，用於上傳文件。
    2.  API 能接收文件（如 .pdf, .docx）並與該管理員的 `company_id` 關聯。
    3.  後端程式能自動讀取文件內容、將其切割成適當的文字片段 (chunks)。
    4.  系統能為每個文字片段生成向量 (embedding)。
    5.  文字片段與其對應的向量被成功存入 PostgreSQL 資料庫中，並標記正確的 `company_id`。

#### Story 2.2: 管理員文件管理介面
* **As an** 管理員 (Administrator),
* **I want** 一個可以上傳並查看現有知識文件的介面,
* **so that** 我可以管理我公司的知識庫。
* **驗收標準 (Acceptance Criteria):**
    1.  管理後台有一個「知識庫管理」頁面。
    2.  頁面上會列出目前已上傳、屬於該公司的所有文件。
    3.  頁面提供一個「上傳新文件」的按鈕，點擊後可以選擇本機檔案。
    4.  文件上傳成功後，頁面會顯示成功訊息，並且文件列表會更新。

#### Story 2.3: 員工登入與對話介面基礎
* **As an** 員工 (Employee),
* **I want** 一個可以登入並看到對話視窗的頁面,
* **so that** 我可以準備開始提問。
* **驗收標準 (Acceptance Criteria):**
    1.  提供一個員工專用的登入頁面，可輸入員工編號。
    2.  成功登入後，頁面會跳轉至主對話介面 (`/chat`)。
    3.  對話介面包含一個文字輸入框、一個發送按鈕以及一個顯示對話歷史的區域。
    4.  系統能正確識別登入員工的身份及其所屬公司。

#### Story 2.4: 後端 RAG 問答核心邏輯
* **As a** 開發者 (Developer),
* **I want** 一個能接收問題、從 PGVector 檢索相關資料並生成答案的 API,
* **so that** 系統可以回答員工的提問。
* **驗收標準 (Acceptance Criteria):**
    1.  提供一個受員工權限保護的 API 端點，用於接收提問。
    2.  API 接收到問題後，能將問題轉換為向量。
    3.  系統能根據提問的向量，在 PGVector 中進行相似度搜尋，**且搜尋範圍僅限於該員工所屬公司的資料**。
    4.  系統將搜尋到的最相關的文字片段作為上下文 (context)，交給大型語言模型 (LLM)。
    5.  大型語言模型根據上下文生成回答，並由 API 回傳給前端。

#### Story 2.5: 前後端對話流程串接
* **As an** 員工 (Employee),
* **I want** 在對話介面輸入問題後，能看到 AI 生成的答案,
* **so that** 我可以解決我的疑問。
* **驗收標準 (Acceptance Criteria):**
    1.  在對話介面輸入問題並點擊發送後，前端會呼叫後端的問答 API。
    2.  在等待後端回覆時，介面會顯示一個讀取中的提示。
    3.  成功收到後端回傳的答案後，答案會被顯示在對話歷史區域。
    4.  如果 API 發生錯誤，介面會顯示一則友善的錯誤訊息。

## Epic 3: 管理與優化儀表板 (Management & Optimization Dashboard)

**Epic 目標:**
這個 Epic 的目標是完善管理員的後台功能，建立一個完整的維運與優化閉環。我們將增加文件刪除功能、建立使用者反饋的收集與分析機制，並提供一個介面來檢視系統內部知識庫的構成。完成後，管理員將擁有監控、管理並持續提升系統品質所需的一切工具。

#### Story 3.1: 知識文件刪除功能
* **As an** 管理員 (Administrator),
* **I want** 能夠從知識庫列表中刪除不再需要的文件,
* **so that** 我可以確保系統只提供最新、最準確的資訊。
* **驗收標準 (Acceptance Criteria):**
    1.  在「知識庫管理」頁面的文件列表中，每一份文件旁都有一個「刪除」按鈕。
    2.  點擊「刪除」按鈕後，會跳出一個確認對話框，防止誤刪。
    3.  確認刪除後，後端 API 會被呼叫，並從資料庫中移除該文件的紀錄及其所有相關的向量資料。
    4.  刪除成功後，前端介面上的文件列表會即時更新。

#### Story 3.2: 員工回饋機制建立
* **As an** 員工 (Employee),
* **I want** 能對 AI 的回答給予簡單的正面或負面評價,
* **so that** 我可以幫助系統變得更聰明。
* **驗收標準 (Acceptance Criteria):**
    1.  在員工的對話介面中，每一則由 AI 生成的答案下方，都附有一對「👍」和「👎」的圖示。
    2.  員工對每則答案只能點擊一次回饋圖示，點擊後圖示狀態改變（例如反白或鎖定）。
    3.  點擊圖示後，前端會呼叫後端 API，記錄下原始問題、AI 回答以及使用者的評價（正面/負面）。
    4.  後端成功將此回饋資訊存入資料庫。

#### Story 3.3: 使用者回饋檢視儀表板
* **As an** 管理員 (Administrator),
* **I want** 一個儀表板來查看所有員工的回饋,
* **so that** 我可以了解系統的表現並找出需要改善的地方。
* **驗收標準 (Acceptance Criteria):**
    1.  管理後台新增一個「使用者回饋」頁面。
    2.  頁面以表格形式顯示回饋列表，包含「問題」、「回答」、「回饋評價 (👍/👎)」、「時間」等欄位。
    3.  提供一個篩選器，讓管理員可以只查看「負面回饋」的紀錄。
    4.  儀表板顯示的資料僅限於該管理員所屬公司的範圍。

#### Story 3.4: Embedding 資料庫檢視介面
* **As an** 管理員 (Administrator),
* **I want** 一個介面能讓我查看系統是如何將文件拆分成知識片段的,
* **so that** 我可以確認系統是否正確地學習了文件內容。
* **驗收標準 (Acceptance Criteria):**
    1.  管理後台新增一個「知識片段檢視」頁面。
    2.  頁面以列表或表格形式，分頁顯示其公司知識庫中所有的文字片段 (text chunks)。
    3.  提供一個搜尋功能，讓管理員能透過關鍵字尋找特定的文字片段。
    4.  每一筆資料都清楚標示其來源於哪一份原始文件。

## 檢查清單結果報告 (Checklist Results Report)

#### 類別狀態 (Category Statuses)

| 類別 | 狀態 | 關鍵問題 |
| :--- | :--- | :--- |
| 1. 問題定義與背景 | ✅ 通過 | 無 |
| 2. MVP 範疇定義 | ✅ 通過 | 無 |
| 3. 使用者體驗需求 | ✅ 通過 | 無 |
| 4. 功能需求 | ✅ 通過 | 無 |
| 5. 非功能需求 | ✅ 通過 | 無 |
| 6. Epic 與故事結構 | ✅ 通過 | 無 |
| 7. 技術指導 | ✅ 通過 | 無 |
| 8. 跨功能需求 | ✅ 通過 | 無 |
| 9. 清晰度與溝通 | ✅ 通過 | 無 |

**最終決定：READY FOR ARCHITECT & UX EXPERT (已準備好交付給架構師與使用者體驗專家)**

## 後續步驟 (Next Steps)

#### 給 UX 專家的指令 (UX Expert Prompt)
"請根據這份 PRD，特別是其中的「使用者介面設計目標」和各個故事中的介面需求，創建一份詳細的「前端規格文件 (UI/UX Specification)」。請專注於定義員工和管理員的核心使用者流程 (User Flows)、元件庫 (Component Library) 和互動細節，為前端開發提供清晰的設計藍圖。"

#### 給架構師的指令 (Architect Prompt)
"請根據這份 PRD，特別是其中的「技術假設」、「功能需求」和「非功能需求」，創建一份完整的「系統架構文件 (Architecture Document)」。請設計一個穩健、可擴展且安全的系統架構，涵蓋前後端、資料庫、API 設計以及部署策略，以實現 PRD 中定義的所有目標。"